<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{{ course.course_name }} - {{ teacher.name }} çš„è¯„ä»·</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
     <!-- å¯¼èˆªæ  -->
     <nav class="navbar">
        <div class="container">
            <a href="{{ url_for('main.index') }}" class="logo">è¯¾ç¨‹è¯„ä»·</a>
            <button class="menu-toggle" aria-label="Toggle navigation">
                â˜°
            </button>
            <ul class="nav-links" id="nav-links">
                <li><a href="{{ url_for('main.index') }}">é¦–é¡µ</a></li>
                <li><a href="{{ url_for('course.list_courses') }}">è¯¾ç¨‹</a></li>
                <li><a href="{{ url_for('teacher.list_teachers') }}">æ•™å¸ˆ</a></li>
                <li><a href="{{ url_for('my.index') }}">æˆ‘çš„</a></li>
                <li><a href="{{ url_for('main.about') }}">å…³äº</a></li>
                {% if current_user.is_authenticated %}
                    <li><a href="{{ url_for('auth.logout') }}" class="btn logout-btn">ç™»å‡º</a></li>
                {% else %}
                    <li><a href="{{ url_for('auth.login') }}" class="btn login-btn">ç™»å½•</a></li>
                    <li><a href="{{ url_for('auth.register') }}" class="btn signup-btn">æ³¨å†Œ</a></li>
                {% endif %}
            </ul>
        </div>
    </nav>
    
    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <ul class="flashes">
        {% for category, message in messages %}
        <li class="alert alert-{{ category }}">
            <span class="message">{{ message }}</span>
            <button class="close-btn" aria-label="Close">&times;</button>
        </li>
        {% endfor %}
    </ul>
    {% endif %}
    {% endwith %}

    
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜å’Œè¯„åˆ† -->
        <h1 class="page-title">{{ course.course_name }} - {{ teacher.name }} çš„è¯„ä»·</h1>
         <!-- è¿”å›æŒ‰é’® -->
         <a href="{{ url_for('course.list_courses') }}" class="btn back-btn">è¿”å›è¯¾ç¨‹åˆ—è¡¨</a>
         <a href="{{ url_for('teacher.list_teachers') }}" class="btn back-btn">è¿”å›æ•™å¸ˆåˆ—è¡¨</a>
    

        
        <!-- æ·»åŠ åˆ°æˆ‘çš„è¯¾ç¨‹ -->
        <div class="add-to-my-courses">
            <form method="POST" action="{{ url_for('review.course_teacher_reviews', course_id=course.id, teacher_id=teacher.id) }}">
                {{ form.hidden_tag() }}
                <button type="submit" class="btn add-course-btn">æ·»åŠ åˆ°æˆ‘çš„è¯¾ç¨‹</button>
            </form>
        </div>

        <div class="average-rating">
            <p>å¹³å‡è¯„åˆ†: <span class="rating">{{ average_rating }}{% if average_rating != 'æš‚æ— è¯„åˆ†' %} / 5{% endif %}</span></p>
        </div>

        <!-- AI æ€»ç»“åŒº -->
        <section class="ai-summary">
            <h2>AI ç”Ÿæˆçš„è¯¾ç¨‹æ€»ç»“</h2>
            <div class="summary-content">
                {% if course_teacher.summary_data %}
                    <p>{{ course_teacher.summary_data.replace('\n', '<br>') | safe }}</p>
                {% else %}
                    <p>è¯¥è¯¾ç¨‹è¿˜æ²¡æœ‰ç”Ÿæˆ AI æ€»ç»“ã€‚</p>
                {% endif %}
            </div>
        </section>

        <!-- æäº¤è¯„ä»·è¡¨å• -->
        {% if current_user.is_authenticated %}
        <section class="submit-review">
            <h2>æäº¤æ‚¨çš„è¯„ä»·</h2>
            <form id="submitReviewForm" action="{{ url_for('review.submit_review', course_id=course.id, teacher_id=teacher.id) }}" method="POST">
                {{ form.hidden_tag() }}
                <div class="form-group">
                    <label for="rating">è¯„åˆ†:</label>
                    <select name="rating" id="rating" required>
                        <option value="5">5 - ä¼˜ç§€</option>
                        <option value="4">4 - å¾ˆå¥½</option>
                        <option value="3">3 - ä¸€èˆ¬</option>
                        <option value="2">2 - å·®</option>
                        <option value="1">1 - å¾ˆå·®</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="comment">è¯„è®º:</label>
                    <textarea name="comment" id="comment" rows="4" placeholder="åœ¨è¯„è®ºæ—¶ï¼Œæœ€å¥½åŠ ä¸Šæ‚¨ä¸Šè¯¾çš„å­¦æœŸï¼Œä¾¿äºæ•°æ®åˆ†æã€‚æœŸå¾…æ‚¨çš„ç²¾å½©è¯„è®ºï¼" required></textarea>
                </div>
                <button type="submit" class="btn submit-btn">æäº¤è¯„ä»·</button>
            </form>

            <!-- Loading çŠ¶æ€ -->
            <div id="loadingMessage" class="loading-message">
                <p>æ­£åœ¨å®¡æ ¸ï¼Œè¯·ç¨å€™...</p>
            </div>

        </section>
        {% else %}
        <div class="login-prompt">
            <p>è¯·å…ˆ <a href="{{ url_for('auth.login') }}">ç™»å½•</a> åå†æäº¤è¯„ä»·ã€‚</p>
        </div>
        {% endif %}

        <!-- è¯„ä»·åˆ—è¡¨ -->
        <section class="reviews">
            <h2>å­¦ç”Ÿè¯„ä»·</h2>
            {% if reviews %}
                <div class="review-list">
                    {% for review in reviews %}
                    <div class="review-item">
                        <div class="review-header">
                            <span class="review-username">è¯„è®ºå®¶: {{ review.user.name }}</span>
                            <span class="review-rating">è¯„åˆ†: {{ review.rating }} / 5</span>
                            <span class="review-date">{{ review.created_at.strftime('%Y-%m-%d') }}</span>
                        </div>
                        <div class="review-content">
                            <p>{{ review.comment }}</p>
                        </div>
                        <div class="review-actions">
                            <button class="like-btn" data-review-id="{{ review.id }}">
                                ğŸ‘ {{ review.likes }}
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <!-- åˆ†é¡µå¯¼èˆª -->
                <div class="pagination">
                    {% if pagination %}
                        <a href="{{ url_for('review.course_teacher_reviews', course_id=course.id, teacher_id=teacher.id, page=pagination.prev_num) }}" class="btn pagination-btn" {% if not pagination.has_prev %}disabled{% endif %}>ä¸Šä¸€é¡µ</a>
                        <span>ç¬¬ {{ pagination.page }} é¡µï¼Œå…± {{ pagination.pages }} é¡µ</span>
                        <a href="{{ url_for('review.course_teacher_reviews', course_id=course.id, teacher_id=teacher.id, page=pagination.next_num) }}" class="btn pagination-btn" {% if not pagination.has_next %}disabled{% endif %}>ä¸‹ä¸€é¡µ</a>
                    {% endif %}
                </div>
            {% else %}
                <p>è¯¥æ•™å¸ˆçš„æ­¤è¯¾ç¨‹å°šæ— è¯„ä»·ã€‚</p>
            {% endif %}
        </section>

        
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>

    

</body>
</html>
